<!DOCTYPE html>
<html>
  <head>
    <title>AR.js World Physics Example</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <script>
      AFRAME.registerComponent('flickable', {
        init: function () {
          let el = this.el;
          let start = null;

          window.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
              start = e.touches[0];
            }
          });

          window.addEventListener('touchend', (e) => {
            if (!start) return;

            let end = e.changedTouches[0];
            let dx = end.clientX - start.clientX;
            let dy = end.clientY - start.clientY;

            if (Math.abs(dy) > 30 && Math.abs(dy) > Math.abs(dx)) {
              const camera = document.querySelector('[camera]').object3D;
              const forward = new THREE.Vector3();
              camera.getWorldDirection(forward);
              forward.multiplyScalar(-2);

              el.setAttribute('velocity', {
                x: forward.x,
                y: forward.y,
                z: forward.z
              });

              el.setAttribute('dynamic-body', 'mass: 1');
            }
            start = null;
          });
        }
      });

      AFRAME.registerComponent('collision-listener', {
        init: function () {
          this.el.addEventListener('collide', (e) => {
            console.log('Ball collided with:', e.detail.body.el);
            if (e.detail.body.el && e.detail.body.el.id === 'hoop-collider') {
              console.log('Ball hit the hoop!');
              this.el.setAttribute('material', 'color', 'red');
            }
          });
        }
      });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene physics="debug: true" embedded>

      <!-- World-space hoop collider -->
      <a-box id="hoop-collider" position="0 1 -3" scale="1 0.2 1"
             material="color: yellow" static-body></a-box>

      <!-- World-space ball -->
      <a-entity id="ball"
                geometry="primitive: sphere; radius: 0.1"
                material="color: orange"
                position="0 0.5 0"
                dynamic-body
                flickable
                collision-listener>
      </a-entity>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
