<!DOCTYPE html>
<html>

<head>
  <title>AR.js Hiro Marker Example</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <script>
    AFRAME.registerComponent('flickable', {
      init: function () {
        const el = this.el;
        let start = null;
        let physicsBody = null;

        // Wait for physics body to be ready
        el.addEventListener('body-loaded', () => {
          physicsBody = el.body;
        });

        // Record start of touch
        window.addEventListener('touchstart', (e) => {
          if (e.touches.length === 1) {
            start = e.touches[0];
          }
        });

        // Detect flick and apply velocity
        window.addEventListener('touchend', (e) => {
          if (!start || !physicsBody) return;

          let end = e.changedTouches[0];
          let dx = end.clientX - start.clientX;
          let dy = end.clientY - start.clientY;

          if (Math.abs(dy) > 30 && Math.abs(dy) > Math.abs(dx)) {
            // Direction based on camera
            const camera = document.querySelector('[camera]').object3D;
            const forward = new THREE.Vector3();
            camera.getWorldDirection(forward);
            forward.normalize();

            // Add forward force and arc
            const velocity = new CANNON.Vec3(
              forward.x * 2,
              4,                    // upward arc
              forward.z * 2
            );

            physicsBody.velocity.copy(velocity);
          }

          start = null;
        });
      }
    });
  </script>
</head>

<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs>
    <!-- Assets -->
    <a-assets>
      <a-asset-item id="basketball_hoop" src="assets/basketball_hoop/scene.gltf"></a-asset-item>
    </a-assets>

    <!-- Marker with model -->
    <a-marker preset="hiro">
      <a-entity gltf-model="#basketball_hoop" scale="0.001 0.001 0.001" position="0 0 0" rotation="270 180 180">
      </a-entity>
    </a-marker>

    <a-entity id="ball" geometry="primitive: sphere; radius: 0.1" material="color: orange" position="0 -0.3 -1.5"
      dynamic-body flickable>
    </a-entity>

    <!-- Camera -->
    <a-entity camera></a-entity>
  </a-scene>
</body>

</html>
